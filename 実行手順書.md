# ゆっくり実況動画作成 実行手順書

このドキュメントは、**input.md** に記載された原稿から、Remotionでゆっくり実況動画を作成する手順を説明します。

## 前提条件

- Node.js v22以上がインストール済み
- VOICEPEAK がインストール済み（パス: C:\\voicepeak\\VOICEPEAK\\voicepeak.exe）
- 依存パッケージがインストール済み（npm install 実行済み）

---

## 動画作成の全体フロー

```
input.md（原稿：通常のテキスト形式）
    ↓
movieyou.md（動画用台本：マークダウン形式）自動生成
    ↓
transcripts/myvideo.tsx（TypeScript台本）自動生成
    ↓
音声ファイル生成（VOICEPEAK）
    ↓
プレビュー確認
    ↓
動画レンダリング
```

---

## ステップ1: movieyou.md（動画用台本）の生成

### 1-1. input.md から movieyou.md への変換

以下のコマンドで、**input.md** から **movieyou.md** を自動生成します：

```bash
npm run convert:movieyou
```

このコマンドは、input.md を読み取り、**マークダウン形式**で movieyou.md を生成します：

```markdown
# Remotion入門

## セクション1: イントロダクション

### 霊夢
ねえねえ魔理沙

### 魔理沙
なんだ霊夢

### 霊夢
今日は何の話をするの？

### 魔理沙
それはね...

## セクション2: 本編

### 霊夢
面白い話ね！
```

### 1-2. movieyou.md のフォーマット

- `#` で動画タイトルを定義
- `##` で各セクションを定義
- `###` で話者を指定
- 話者の直後の行にセリフを記述

---

## ステップ2: TypeScript台本ファイルの生成

### 2-1. movieyou.md から transcripts/myvideo.tsx への変換

以下のコマンドで、**movieyou.md** から **transcripts/myvideo.tsx** を自動生成します：

```bash
npm run convert:input
```

このコマンドは：
- movieyou.md を読み取る
- 各セリフにUUIDを自動生成
- TypeScript形式の台本ファイルを作成

生成されるファイルの例：

```typescript
export const MyVideoConfig: VideoConfig = {
  sections: [
    {
      title: 'イントロダクション',
      talks: [
        {
          text: 'ねえねえ魔理沙',
          speaker: 'reimu',
          id: '5d64484cf146478aaae76a30fc4d31fa',
          audioDurationFrames: 0,
        },
        // ...
      ],
      // ...
    },
  ],
};
```

---

## ステップ3: 音声ファイルの生成

### 3-1. VOICEPEAKで音声を生成

以下のコマンドを実行して、全てのセリフの音声ファイルを生成します：

```bash
npm run generate:voicepeak
```

このコマンドは：
- **transcripts/myvideo.tsx** からセリフを読み取る
- 各セリフごとにVOICEPEAKで音声生成
- **public/audio/yukkuri/{id}.wav** として保存
- 既存ファイルは自動的にスキップ

### 3-2. 音声設定のカスタマイズ

音声の設定を変更する場合は、**scripts/generateVoicepeakAudios.ts** を編集：

```typescript
// 霊夢の声設定
const REIMU_CONFIG = {
  voice: 'Haruno Sora',
  speed: 120,
  pitch: -30,
  pause: 130,
  volume: 80,
  emotion: 'happy=30,sad=10,angry=0,whisper=20,cool=15',
};

// 魔理沙の声設定
const MARISA_CONFIG = {
  voice: 'Haruno Sora',
  speed: 115,
  pitch: -50,
  pause: 130,
  volume: 80,
  emotion: 'happy=15,sad=15,angry=0,whisper=30,cool=35',
};
```

### 3-3. 音声の長さを台本に反映

音声ファイル生成後、以下のコマンドで音声の長さを台本に反映します：

```bash
npm run update:audio-durations
```

このコマンドは：
- 生成された音声ファイルの長さを取得
- **transcripts/myvideo.tsx** の `audioDurationFrames` と `totalFrames` を更新
- プレビューと動画レンダリングに必要な情報を設定

### 3-4. 強制再生成

既存音声を削除して再生成したい場合：

```bash
rm -rf public/audio/yukkuri
npm run generate:voicepeak
npm run update:audio-durations
```

---

## ステップ4: プレビューで確認

### 4-1. プレビューサーバーの起動

```bash
npm start
```

ブラウザで以下のURLを開きます：
- **http://localhost:3000**

### 4-2. プレビューでの確認事項

✅ 音声が正しく再生されるか
✅ 字幕が表示されるか
✅ キャラクターが表示されるか
✅ タイミングがずれていないか

---

## ステップ5: 動画のレンダリング

### 5-1. レンダリングコマンド

```bash
npm run build:myvideo
```

（注意: package.jsonにコマンドを追加する必要があります）

### 5-2. 出力先

レンダリングされた動画は **out/myvideo.mp4** に保存されます。

---

## クイックスタート（要約）

```bash
# 前提: input.md に原稿を配置済み

# 1. movieyou.md を生成（マークダウン形式に変換）
npm run convert:movieyou

# 2. TypeScript台本を生成
npm run convert:input

# 3. 音声ファイルを生成
npm run generate:voicepeak

# 4. 音声の長さを台本に反映
npm run update:audio-durations

# 5. プレビュー確認
npm start

# 6. 動画をレンダリング
npm run build:myvideo
```

---

## トラブルシューティング

### 音声が生成されない

- VOICEPEAKのパスを確認: `C:\\voicepeak\\VOICEPEAK\\voicepeak.exe`
- `scripts/generateVoicepeakAudios.ts` の `VOICEPEAK_PATH` を修正

### プレビューでエラー

- `public/audio/yukkuri/` に音声ファイルがあるか確認
- ブラウザのコンソールでエラー内容を確認

### レンダリングが遅い

- 動画の長さやエフェクトによっては数分〜数十分かかります
- 不要なセクションをコメントアウトしてテスト

---

## 参考ファイル

- **台本サンプル**: transcripts/firstvideo.tsx
- **音声生成スクリプト**: scripts/generateVoicepeakAudios.ts
- **動画設定型定義**: src/yukkuri/yukkuriVideoConfig.ts

---

## まとめ

このワークフローにより、**input.md に配置した原稿** から **ゆっくり実況動画** を簡単に作成できます！

1. **input.md** に原稿を配置（ユーザーが事前に準備）
2. **movieyou.md** でマークダウン形式に自動変換
3. **TypeScript台本** で動画設定を自動生成
4. **VOICEPEAK** で音声を自動生成
5. **Remotion** でプレビュー＆レンダリング

以上で完了です！
